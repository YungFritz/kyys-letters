<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ajouter un chapitre — Kyy’s Letters</title>
  <link rel="stylesheet" href="/styles/base.css"/>
</head>
<body>
  <div class="header"><div class="header-inner">
    <a class="logoK" href="/">K</a>
    <a class="nav-btn" href="/admin.html">Panneau</a>
  </div></div>

  <div class="container">
    <div class="card-like">
      <h2>Ajouter un chapitre</h2>
      <form id="f" class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
        <div>
          <label class="muted">Série</label>
          <select id="series" class="in" required></select>
        </div>
        <div>
          <label class="muted">Langue</label>
          <input id="lang" class="in" placeholder="FR, EN..." value="FR"/>
        </div>
        <div>
          <label class="muted">Numéro</label>
          <input id="num" class="in" type="number" min="0" step="1" required/>
        </div>
        <div>
          <label class="muted">Nom du chapitre</label>
          <input id="name" class="in" placeholder="Nom"/>
        </div>
        <div style="grid-column:1/-1">
          <label class="muted">Pages (images)</label><br/>
          <input id="pages" type="file" multiple accept="image/*"/>
        </div>
        <div style="grid-column:1/-1;display:flex;gap:8px">
          <button class="btn acc" type="submit">Enregistrer</button>
          <a class="btn" href="/admin.html">Annuler</a>
        </div>
      </form>
    </div>

    <div class="footer">© 2025 — Kyy’s Letters</div>
  </div>

  <script src="/js/storage.js"></script>
  <script>
    const { allSeries, addChapter } = window.KyyStore;

    // peupler le select
    const sel = document.getElementById("series");
    const list = allSeries();
    if (!list.length) { alert("Aucune série. Ajoute d'abord une série."); location.href="/add-manga.html"; }
    list.forEach(s=>{
      const opt = document.createElement("option");
      opt.value = s.id; opt.textContent = s.title;
      sel.appendChild(opt);
    });

    document.getElementById("f").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const seriesId = sel.value;
      const number = Number(document.getElementById("num").value);
      const name   = document.getElementById("name").value.trim();
      const lang   = document.getElementById("lang").value.trim();
      const files  = Array.from(document.getElementById("pages").files||[]);

      await addChapter({ seriesId, number, name, lang, pageFiles: files });
      location.href = "/admin.html";
    });
  </script>
</body>
</html>
