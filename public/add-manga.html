<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Ajouter un manga • Kyy’s Letters</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="/page.css" rel="stylesheet">
</head>
<body>
  <div class="wrap">
    <!-- Barre du haut -->
    <div class="topbar">
      <a class="pill k" href="/">K</a>
      <a class="pill" href="/personnelle.html">Personnelle</a>
      <a class="pill" href="/recrutement.html">Recrutement</a>
      <a class="pill" href="/admin.html">Admin</a>
      <a class="pill" href="/">Accueil</a>
    </div>

    <!-- Carte formulaire -->
    <div class="card pad">
      <h1>Ajouter un manga</h1>
      <div class="row" style="margin-top:12px">
        <input id="title" class="input" placeholder="Titre">
        <input id="tags" class="input" placeholder="Tags (FR, Action… séparés par ,)">
        <textarea id="description" class="textarea" placeholder="Description"></textarea>

        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
          <input id="cover" class="file" type="file" accept="image/*">
          <button id="save" class="btn">Enregistrer</button>
          <a class="btn ghost" href="/admin.html">← Admin</a>
        </div>
      </div>
      <p id="status" style="margin-top:10px;color:var(--muted)"></p>
    </div>
  </div>

<script>
/* ====== store helpers ====== */
const get = (k, d) => {
  try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d }
}
const set = (k, v) => localStorage.setItem(k, JSON.stringify(v));

/* ====== Save manga ====== */
document.getElementById('save').addEventListener('click', async () => {
  const title = document.getElementById('title').value.trim();
  const tags  = document.getElementById('tags').value.trim()
                  .split(',').map(s=>s.trim()).filter(Boolean);
  const description = document.getElementById('description').value.trim();
  const file = document.getElementById('cover').files[0];

  if(!title){ return msg("Titre obligatoire."); }

  let cover = '';
  if(file){
    cover = await toBase64(file);
  }

  const slug = slugify(title);
  const mangas = get('mangas', []);
  if(mangas.some(m => m.slug === slug)){
    return msg("Un manga avec ce titre existe déjà.");
  }

  mangas.push({
    id: crypto.randomUUID(),
    title, slug, tags, description, cover,
    chapters: [], views: 0, hot: false,
    createdAt: Date.now()
  });

  set('mangas', mangas);
  msg("Manga enregistré ✅");
  // Optionnel : rediriger sur la page admin
  // location.href = "/admin.html";
});

function msg(t){ document.getElementById('status').textContent = t; }
function slugify(s){
  return s.toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
}
function toBase64(file){
  return new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = () => res(fr.result);
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
}
</script>
</body>
</html>
