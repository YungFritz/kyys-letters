<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Lecteur — Kyy’s Letters</title>
  <link rel="stylesheet" href="/styles/base.css">
  <style>
    body{background:#0f1011;color:#e9ebee;margin:0}
    .wrap{max-width:980px;margin:0 auto;padding:10px}
    .page{width:100%;margin:0 0 14px 0;border-radius:8px;overflow:hidden;background:#111}
    .page img{width:100%;display:block}
    .topbar{position:sticky;top:0;background:rgba(10,10,10,.85);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.06);padding:10px}
    a.btn{display:inline-grid;place-items:center;height:34px;padding:0 12px;background:#101112;border:1px solid rgba(255,255,255,.06);border-radius:10px;text-decoration:none;color:#e9ebee}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="wrap">
      <a class="btn" href="/">Accueil</a>
      <a class="btn" href="/admin.html" style="margin-left:8px">Admin</a>
    </div>
  </div>

  <div class="wrap" id="root">
    <div class="label">Chargement…</div>
  </div>

  <script src="/js/db.js"></script>
  <script src="/js/storage.js"></script>
  <script>
  (async () => {
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    const chaps = KyyStore.allChapters();
    const chap = chaps.find(c => c.id === id);
    const root = document.getElementById('root');
    if (!chap) {
      root.innerHTML = '<div class="label">Chapitre introuvable.</div>';
      return;
    }

    root.innerHTML = '';
    for (const ref of chap.pagesRef || []) {
      const url = await KyyStore.pageURL(ref);
      const div = document.createElement('div');
      div.className = 'page';
      div.innerHTML = url ? `<img loading="lazy" src="${url}" alt="">` : `<div class="label">Image manquante</div>`;
      root.appendChild(div);
    }
  })();
  </script>
</body>
</html>
