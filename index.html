<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Kyyâ€™s letters â€” Accueil</title>
  <link rel="stylesheet" href="/styles/base.css"/>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-inner">
      <a class="logoK" href="/">K</a>

      <!-- Boutons qui MARCHENT -->
      <nav class="desktop-nav">
        <a class="nav-btn" href="/personnelle.html">Perso</a>
        <a class="nav-btn" href="/recrutement.html">Recrutement</a>
        <a class="nav-btn" href="/admin.html">Admin</a>
        <a class="nav-btn" href="/connexion.html">Connexion</a>
      </nav>

      <input class="search-input" id="q" placeholder="Rechercher une sÃ©rie, un tag, une langue..."/>
    </div>
  </div>

  <div class="container">
    <!-- Hero -->
    <div class="hero">
      <div class="card-like hero-card">
        <h1>Bienvenue</h1>
        <div class="muted">Message d'accueil / accroche. Remplace par ton texte.</div>
      </div>
      <aside class="card-like hero-side">
        <div class="side-card">
          <div class="side-title">Rejoindre</div>
          <div class="muted">Lien discord / contact / bouton</div>
          <a class="btn" href="#">Ouvrir</a>
        </div>
        <div class="side-card">
          <div class="side-title">Statistiques</div>
          <div id="stats" class="muted">SÃ©ries: 0 â€¢ Chapitres: 0</div>
        </div>
      </aside>
    </div>

    <!-- Populaire -->
    <section class="section">
      <div class="section-header">
        <div class="section-left">
          <span>ðŸ”¥</span><div class="section-title">Populaire aujourd'hui</div>
        </div>
        <button class="pill">Tendances</button>
      </div>
      <div class="card-like">
        <div id="popular" class="empty">Aucune sÃ©rie ajoutÃ©e pour le moment.</div>
      </div>
    </section>

    <!-- Derniers chapitres -->
    <div class="bottom-grid">
      <div class="card-like">
        <div class="latest-title">DERNIERS CHAPITRES POSTÃ‰S</div>
        <div id="latest" class="empty">Aucun chapitre publiÃ© pour le moment.</div>
      </div>

      <aside class="card-like stats">
        <div class="side-title">Statistiques</div>
        <div class="stats-grid">
          <div class="row"><span>Visites totales (exemple)</span><b>0</b></div>
          <div class="row"><span>SÃ©ries</span><b id="countSeries">0</b></div>
          <div class="row"><span>Chapitres</span><b id="countChapters">0</b></div>
          <div class="row"><span>Langue</span><b>FR</b></div>
        </div>
      </aside>
    </div>

    <div class="footer">Â© 2025 â€” Tous droits rÃ©servÃ©s</div>
  </div>

  <script src="/js/storage.js"></script>
  <script>
    // hydrater l'accueil depuis KyyStore
    const { allSeries, allChapters } = window.KyyStore;

    function renderHome(){
      const series = allSeries();
      const chapters = allChapters();

      // stats
      document.getElementById("countSeries").textContent = series.length;
      document.getElementById("countChapters").textContent = chapters.length;
      document.getElementById("stats").textContent = `SÃ©ries: ${series.length} â€¢ Chapitres: ${chapters.length}`;

      // populaire = 5 derniÃ¨res sÃ©ries
      const pop = document.getElementById("popular");
      if (!series.length){
        pop.className = "empty"; pop.textContent = "Aucune sÃ©rie ajoutÃ©e pour le moment.";
      } else {
        pop.className = "";
        pop.innerHTML = `
          <div class="grid-cards">
            ${series.slice(-5).reverse().map(s=>`
              <a class="card-link" href="/manga.html?slug=${encodeURIComponent(s.slug)}">
                <div class="card">
                  <div class="cover">${s.cover ? `<img src="${s.cover}" alt="">` : "â€”"}</div>
                  <div class="card-body">
                    <div class="card-title">${s.title}</div>
                    <div class="card-meta">
                      <div class="meta-left">${(s.tags||[]).slice(0,3).map(t=>`<span class="badge">${t}</span>`).join("")}</div>
                    </div>
                  </div>
                </div>
              </a>
            `).join("")}
          </div>
        `;
      }

      // derniers chapitres = 10 derniers
      const latest = document.getElementById("latest");
      if (!chapters.length){
        latest.className = "empty"; latest.textContent = "Aucun chapitre publiÃ© pour le moment.";
      } else {
        latest.className = "";
        const rows = chapters.slice().sort((a,b)=>b.createdAt - a.createdAt).slice(0,10).map(ch=>{
          const s = series.find(x=>x.id===ch.seriesId);
          return `<div style="padding:10px;border-bottom:1px solid var(--border)">
                    <b>${s? s.title : "â€”"}</b> â€¢ Chapitre <b>${ch.number||"â€”"}</b> â€¢ ${ch.lang||"?"}
                  </div>`;
        }).join("");
        latest.innerHTML = rows;
      }
    }

    renderHome();
  </script>
</body>
</html>
